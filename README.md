# stateful_network_verify

## Files

* Example*
  * Example network configuration
* templates
  * File templates used to generate c++ code as network model.

## Usage

`python3 generateNetworkCode.py -d "Example 3/" -s Router1 -p 3` will generate a simulator in `Example 3` folder. The simulator will start with a symbolic header at `Router1`'s port `3`.

`cd Example3 && make klee` symbolically executes the simulator.

`make show-tests` shows all the headers generated by *klee* to cover the entire network.

`make show-stats` shows line coverage.

### generateAP

The `generateAP.py` file can take node name and network configuration as input and generate c++ code that enumerates all the equivalent classes on the subset of network that contains only these nodes. 

```shell
python3 generateAP.py -d Example\ 3/ -c Router1,Router2,Router3
```

Then we can go run the generated c++ model with

```
cd Example\ 3
g++ test-driver.cpp &&./a.out
```

The output will be like

```
inNode: Router1,prefix: 00000,outNode: 0, outPort: -1
inNode: Router1,prefix: 0000100,outNode: 0, outPort: -1
inNode: Router1,prefix: 000010100000000000000000,outNode: -1, outPort: -1
...
```

These information can then be used to build an interval tree that act as a LUT for the entire  node set, which allows generating optimized simulator code that corresponds to the entire node set.



**Draw back**

* Nodes in the node set must be
  * Stateless
  * **Longest prefix matching on the destination address**

Thus please do not include nodes with stateful forwarding or load balancing.