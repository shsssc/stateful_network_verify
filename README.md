# stateful_network_verify

## Files

* Example*
  * Example network configuration
* templates
  * File templates used to generate c++ code as network model.

## Usage

`python3 generateNetworkCode.py -d "Example 3/" -s Router1 -p 3` will generate a simulator in `Example 3` folder. The simulator will start with a symbolic header at `Router1`'s port `3`.

`cd Example3 && make klee` symbolically executes the simulator.

`make show-tests` shows all the headers generated by *klee* to cover the entire network.

`make show-stats` shows line coverage.

### Path balance Test

`python3 generateBalanceTestCode.py -d "Example 3/" -s Router1 -p 3 -e 'Core.*'` will generate a simulator in `Example 3` folder. The simulator will start with a symbolic header at `Router1`'s port `3`, and check if the header will forward in a balance way through all router specified with the regex `'Core.*'`.

`cd Example3 && make klee` symbolically executes the simulator.

There may be an imalance if klee emits an assertion error. 

### generateAP

The `generateAP.py` file can take node names and network configuration as input and generate c++ code that enumerates all the equivalent classes on the subset of network that contains only these nodes. 

```shell
python3 generateAP.py -d Example\ 3/ -c Router1,Router2,Router3
```

A C++ model will be automatically generated and executed to store the output of each equivalence class at `ecs.csv`

**Draw back**

* Nodes in the node set must be
  * Stateless
  * **Longest prefix matching on the destination address**

Thus please do not include nodes with stateful forwarding or load balancing.

### Using the generated Equivalence Classes

The equivalence classes can be used when generating network code:

```
 python3 generateNetworkCode.py -d Example\ 3/ -s Router1 -p 1 -o True
```

The `-o True` will enable the generator to discover `*ecs.csv` files inside the directory and generate router code based on it. By default this optimization is off.